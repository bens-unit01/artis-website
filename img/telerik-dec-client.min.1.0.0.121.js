var sfDataIntell=sfDataIntell||{};sfDataIntell.constants={endpoints:{apiServer:"https://api.dec.sitefinity.com"},headers:{authorization:"Authorization",datacenterkey:"x-dataintelligence-datacenterkey",subject:"x-dataintelligence-subject",ids:"x-dataintelligence-ids",datasource:"x-dataintelligence-datasource",contacts:"x-dataintelligence-contacts"}};var sfDataIntell=sfDataIntell||{};!function(a){a.Client=function(b){var c=this;if(b=b||{},!b.apiKey)throw new Error("You must provide the ApiKey for the Data Center.");if(!b.source)throw new Error("You must provide the source name of the client.");this.isLocalStorageSupported=this.isLocalStorageSupported();var d=b.subjectCookieName||"sf-data-intell-subject",e=b.subjectKey||this.readCookie(d);if((null===e||""===e)&&(e=this.generateSubjectKey(),this.setCookie(d,e,365,b.trackingCookieDomain),window.detect)){var f=this.getParseUserAgent(),g=this.getBrowserLanguage();this.subjectMetadataClient=new a.SubjectMetadataClient(e,this.isLocalStorageSupported);var h=[{K:"Browser",V:f.browser.family},{K:"Browser version",V:f.browser.version},{K:"Browser language",V:g},{K:"Device",V:f.device.family},{K:"Device type",V:f.device.type}];null!==f.device.manufacturer&&""!==f.device.manufacturer&&h.push({K:"Device manufacturer",V:f.device.manufacturer}),this.subjectMetadataClient.writeSubjectMetadata(h)}"boolean"==typeof b.autoTracking?this.autoTracking=b.autoTracking:this.autoTracking=!0,this.apiKey=b.apiKey,this.source=b.source,this.authToken=b.authToken,this.apiServerUrl=b.apiServerUrl||sfDataIntell.constants.endpoints.apiServer,this.sentenceClient=new a.SentenceClient(e,this.isLocalStorageSupported),this.subjectMetadataClient=new a.SubjectMetadataClient(e,this.isLocalStorageSupported),this.personalizationClient=new a.PersonalizationClient(this.apiServerUrl,e,this.apiKey,this.source,this.authToken),this.mappingsClient=new a.MappingsClient(this.apiServerUrl,e,this.apiKey,this.source),b.instrument&&(this.instrumenter=new a.HtmlInstrumenter(this.sentenceClient),this.instrumenter.startTracking()),b.trackPageVisits&&(this.pageVisitsTracker=new a.PageVisitsTracker(this.sentenceClient,b.trackPageVisits.predicate,b.trackPageVisits.obj,b.trackPageVisits.objMetadata),this.pageVisitsTracker.startTracking()),b.trackUtmParameters&&(this.utmParametersTracker=new a.UtmParametersTracker(this.sentenceClient,b.trackUtmParameters.predicate,b.trackUtmParameters.obj,b.trackUtmParameters.objMetadata,b.trackUtmParameters.subMetadata),this.utmParametersTracker.startTracking()),b.trackReferrer&&(this.referrerTracker=new a.ReferrerTracker(this.sentenceClient,b.trackReferrer.predicate,b.trackReferrer.obj,b.trackReferrer.objMetadata),this.referrerTracker.startTracking()),this.autoTracking&&setInterval(function(){c.flushData(c)},5e3)},a.Client.prototype={generateSubjectKey:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0,c="x"==a?b:3&b|8;return c.toString(16)})},setCookie:function(a,b,c,d){var e=new Date;e.setTime(e.getTime()+24*c*60*60*1e3);var f="expires="+e.toGMTString(),g=a+"="+b+";path=/; "+f;d&&(g+=";domain="+d),document.cookie=g},readCookie:function(a){for(var b=a+"=",c=window.document.cookie.split(";"),d=0;d<c.length;d++){var e=c[d].trim();if(0===e.indexOf(b))return e.substring(b.length,e.length)}return null},flushData:function(a){var b,c;a.isLocalStorageSupported?(localStorage.sentences&&(b=JSON.parse(localStorage.sentences),a.flushSentences(a,b),localStorage.sentences=""),localStorage.subjectMetadata&&(c=JSON.parse(localStorage.subjectMetadata),a.flushSubjectMetadata(a,c),localStorage.subjectMetadata="")):(window.tempStorage.sentences&&(b=JSON.parse(window.tempStorage.sentences),a.flushSentences(a,b),window.tempStorage.sentences=""),window.tempStorage.subjectMetadata&&(c=JSON.parse(window.tempStorage.subjectMetadata),a.flushSubjectMetadata(a,c),window.tempStorage.subjectMetadata=""))},flushSentences:function(a,b){1==b.length&&(b=b[0]),$.ajax({url:a.apiServerUrl+"/collect/v1/data-centers/"+a.apiKey+"/sentences/datasource/"+a.source,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(b)})},flushSubjectMetadata:function(a,b){1==b.length&&(b=b[0]),$.ajax({url:a.apiServerUrl+"/collect/v1/data-centers/"+a.apiKey+"/metadata/subjects/datasource/"+a.source,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(b)})},getParseUserAgent:function(){var a=detect.parse(navigator.userAgent);return a},getBrowserLanguage:function(){var a=navigator.language||navigator.userLanguage;return a},isLocalStorageSupported:function(){var a="test";try{return localStorage.setItem(a,"1"),localStorage.removeItem(a),!0}catch(b){return window.tempStorage={},!1}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.decisionTreeClient={}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.HtmlInstrumenter=function(a){this.sentenceClient=a},a.HtmlInstrumenter.prototype={startTracking:function(){var a=this;$("[sfdi-trigger]").each(function(b){var c=$(this),d=c.attr("sfdi-trigger"),e=c.attr("sfdi-predicate"),f=c.attr("sfdi-object"),g=c.attr("sfdi-obj-metadata"),h=c.attr("sfdi-sub-metadata");g=a.buildMetadataArray(g),h=a.buildMetadataArray(h),c.on(d,function(){a.sentenceClient.writeSentence({predicate:e,object:f,objectMetadata:g,subjectMetadata:h})})})},buildMetadataArray:function(a){return a?a=JSON.parse(a.replace(new RegExp("\\\\","gm"),"").replace(new RegExp("'","gm"),'"')):null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SentenceClient=function(a,b){this.subjectKey=a,this.isLocalStorageSupported=b},a.SentenceClient.prototype={writeSentence:function(a){if(!a)throw new Error('You must provide "sentence" argument when writing a sentence.');if(!a.predicate)throw new Error('You must provide "sentence.predicate" argument when writing a sentence.');if(!a.object)throw new Error('You must provide "sentence.object" argument when writing a sentence.');var b;b=this.isLocalStorageSupported?localStorage.sentences?JSON.parse(localStorage.sentences):[]:window.tempStorage.sentences?JSON.parse(window.tempStorage.sentences):[],b.push({S:this.subjectKey,P:a.predicate,O:a.object,SM:a.subjectMetadata,OM:a.objectMetadata}),this.isLocalStorageSupported?localStorage.sentences=JSON.stringify(b):window.tempStorage.sentences=JSON.stringify(b)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.subjectMappingClient={}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PageVisitsTracker=function(a,b,c,d){this.sentenceClient=a,this.predicate=b||"Visit",this.obj=c||location.href,this.objMetadata=d||[{K:"PageTitle",V:document.title}]},a.PageVisitsTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.sentenceClient.writeSentence({predicate:a.predicate,object:a.obj,objectMetadata:a.objMetadata})})}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.SubjectMetadataClient=function(a,b){this.subjectKey=a,this.isLocalStorageSupported=b},a.SubjectMetadataClient.prototype={writeSubjectMetadata:function(a){if(!a)throw new Error('You must provide "metadata" argument when writing subject metadata.');var b;b=this.isLocalStorageSupported?localStorage.subjectMetadata?JSON.parse(localStorage.subjectMetadata):[]:window.tempStorage.subjectMetadata?JSON.parse(window.tempStorage.subjectMetadata):[],b.push({S:this.subjectKey,M:a}),this.isLocalStorageSupported?localStorage.subjectMetadata=JSON.stringify(b):window.tempStorage.subjectMetadata=JSON.stringify(b)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.UtmParametersTracker=function(a,b,c,d,e){this.sentenceClient=a,this.predicate=b||"Participate in campaign",this.obj=c||location.search,this.objMetadata=d,this.subMetadata=e},a.UtmParametersTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.handleUtmParamsTracking.call(a)})},handleUtmParamsTracking:function(){var a=this.buildUtmParamsObject(this.obj);null!==a&&this.sentenceClient.writeSentence({predicate:this.predicate,object:a,objectMetadata:this.objMetadata,subjectMetadata:this.subMetadata})},buildUtmParamsObject:function(a){if(a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1){var b=a.slice(1).split("&"),c=b.filter(function(a){return a.indexOf("utm_source")>-1||a.indexOf("utm_medium")>-1||a.indexOf("utm_term")>-1||a.indexOf("utm_content")>-1||a.indexOf("utm_campaign")>-1}),d="?"+c.join("&");return d}return null}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.ReferrerTracker=function(a,b,c,d){this.sentenceClient=a,this.predicate=b||"Come from site",this.obj=c||document.referrer,this.objMetadata=d},a.ReferrerTracker.prototype={startTracking:function(){var a=this;$(document).ready(function(){a.handleTracking.call(a,location.hostname)})},handleTracking:function(a){this.obj&&this.parseURL(this.obj).hostname!==a&&this.sentenceClient.writeSentence({predicate:this.predicate,object:this.obj,objMetadata:this.objMetadata})},parseURL:function(a){var b=document.createElement("a");return b.href=a,{source:a,hostname:b.hostname}}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.PersonalizationClient=function(a,b,c,d,e){this.apiServerUrl=a,this.subjectKey=b,this.apiKey=c,this.datasource=d,this.authToken=e},a.PersonalizationClient.prototype={call:function(a,b,c,d){if(!this.authToken)throw new Error('You must provide "authToken" when using the Personalization Client.');var e={url:this.apiServerUrl+a,type:"GET",headers:b||{},contentType:"application/json"};e.headers[sfDataIntell.constants.headers.authorization]=this.authToken,e.headers[sfDataIntell.constants.headers.datacenterkey]=this.apiKey,c&&(e.success=c),d&&(e.error=d),jQuery.ajax(e)},isInCampaigns:function(a,b,c){if(!a)throw new Error('You must provide "campaignIds" argument when using the "isInCampaigns" method.');var d={};d[sfDataIntell.constants.headers.subject]=this.subjectKey,d[sfDataIntell.constants.headers.ids]=a,d[sfDataIntell.constants.headers.datasource]=this.datasource,this.call("/analytics/v1/campaigns/isin",d,b,c)},isInLeads:function(a,b,c,d){if(!a)throw new Error('You must provide "scoringIds" argument when using the "isInLeads" method.');if(!b)throw new Error('You must provide "contactsDetails" argument when using the "isInLeads" method.');var e={};e[sfDataIntell.constants.headers.contacts]=b,e[sfDataIntell.constants.headers.ids]=a,this.call("/analytics/v1/scorings/leads/in",e,c,d)},isInPersonas:function(a,b,c,d){if(!a)throw new Error('You must provide "scoringIds" argument when using the "isInCampaigns" method.');d=d||this.subjectKey;var e={};e[sfDataIntell.constants.headers.datasource]=this.datasource,e[sfDataIntell.constants.headers.subject]=d,e[sfDataIntell.constants.headers.ids]=a,this.call("/analytics/v1/scorings/personas/in",e,b,c)}}}(sfDataIntell);var sfDataIntell=sfDataIntell||{};!function(a){a.MappingsClient=function(a,b,c,d){this.apiServerUrl=a,this.subject=b,this.apiKey=c,this.datasource=d},a.MappingsClient.prototype={call:function(a,b,c,d){var e={url:this.apiServerUrl+a,type:"POST",contentType:"application/json"};b&&(e.data=JSON.stringify(b),e.dataType="json"),c&&(e.success=c),d&&(e.error=d),jQuery.ajax(e)},newMappingWithCurrent:function(a,b,c,d){if(!a)throw new Error('You must provide "secondSubject" argument when using the "newMappingWithCurrent" method.');if(!b)throw new Error('You must provide "secondDataSource" argument when using the "newMappingWithCurrent" method.');var e={S1:this.subject,D1:this.datasource,S2:a,D2:b},f="/collect/v1/data-centers/"+this.apiKey+"/mappings";this.call(f,e,c,d)}}}(sfDataIntell);